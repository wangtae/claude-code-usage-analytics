# Version 1.3.7

**Release Date**: 2025-10-22

## Overview

ì´ ë²„ì „ì€ Setup Wizardì˜ ì‚¬ìš©ì ê²½í—˜ ê°œì„ ê³¼ Gist ì„¤ì • ì·¨ì†Œ ì‹œ ë°œìƒí•˜ëŠ” ë²„ê·¸ ìˆ˜ì •ì— ì´ˆì ì„ ë§ì¶¥ë‹ˆë‹¤. ì‚¬ìš©ìê°€ Gist ì˜µì…˜ì„ ì„ íƒí–ˆë‹¤ê°€ ì·¨ì†Œí•˜ê±°ë‚˜ í† í° ì…ë ¥ì— ì‹¤íŒ¨í–ˆì„ ë•Œ, ë‹¤ë¥¸ storage ì˜µì…˜ì„ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤.

## Bug Fixes

### 1. Gist Setup ì·¨ì†Œ ì‹œ Storage ì„ íƒ ë³µê·€
**ë¬¸ì œ**: GitHub Gist ì˜µì…˜ ì„ íƒ í›„ í† í° ì…ë ¥ ë‹¨ê³„ì—ì„œ Ctrl+Cë¡œ ì·¨ì†Œí•˜ë©´, storage ì„ íƒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì§€ ì•Šê³  OneDrive ë°©ì‹ìœ¼ë¡œ ìë™ ì§„í–‰ë˜ëŠ” ë¬¸ì œ

**ì›ì¸**: `_setup_gist_sync()`ê°€ ì·¨ì†Œ ì‹œ `None`ì„ ë°˜í™˜í•˜ëŠ”ë°, ì´ë¥¼ "ì „ì²´ setup ì·¨ì†Œ"ë¡œ ì²˜ë¦¬í•˜ì—¬ ì˜ëª»ëœ fallback ë¡œì§ì´ ì‘ë™

**í•´ê²°**:
```python
if gist_result is None:
    # User cancelled Gist setup - return to storage selection
    console.print("[yellow]Gist setup cancelled. Please select a different storage option.[/yellow]\n")
    return _select_database_location(console)  # Recursive call to restart selection
```

**íš¨ê³¼**: Gist ì„¤ì • ì·¨ì†Œ ì‹œ ëª…í™•í•œ ë©”ì‹œì§€ì™€ í•¨ê»˜ Step 1 (storage ì„ íƒ)ìœ¼ë¡œ ëŒì•„ê°

### 2. í† í° ë¯¸ì…ë ¥ ì‹œ Storage ì„ íƒ ë³µê·€
**ë¬¸ì œ**: ì‚¬ìš©ìê°€ Gistë¥¼ ì„ íƒí–ˆì§€ë§Œ í† í°ì„ ì…ë ¥í•˜ì§€ ì•Šê³  Enterë§Œ ëˆ„ë¥´ë©´, local storageë¡œ ìë™ ì§„í–‰

**ë³€ê²½ ì „**:
```python
if not token:
    console.print("[yellow]No token provided. Skipping Gist setup.[/yellow]")
    return False  # Skip â†’ local storageë¡œ ì§„í–‰
```

**ë³€ê²½ í›„**:
```python
if not token:
    console.print("[yellow]No token provided. Cannot proceed with Gist storage.[/yellow]")
    return None  # Cancel â†’ storage ì„ íƒìœ¼ë¡œ ë³µê·€
```

**íš¨ê³¼**: ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ Gistë¥¼ ì„ íƒí–ˆìœ¼ë¯€ë¡œ, í† í°ì´ ì—†ìœ¼ë©´ ë‹¤ë¥¸ ì˜µì…˜ì„ ì„ íƒí•˜ë„ë¡ ìœ ë„

### 3. ì˜ëª»ëœ í† í° ì…ë ¥ ì‹œ Storage ì„ íƒ ë³µê·€
**ë¬¸ì œ**: ì˜ëª»ëœ í† í°ì„ ì…ë ¥í•˜ë©´ "Skipping Gist setup"ìœ¼ë¡œ local storageë¡œ ì§„í–‰

**ë³€ê²½ ì „**:
```python
if not client.test_token():
    console.print(" [red]âœ— Invalid token[/red]")
    console.print("[yellow]Skipping Gist setup. You can retry with: ccu gist setup[/yellow]")
    return False
```

**ë³€ê²½ í›„**:
```python
if not client.test_token():
    console.print(" [red]âœ— Invalid token[/red]")
    console.print("[yellow]Cannot proceed with Gist storage. Please select a different option.[/yellow]")
    return None
```

**íš¨ê³¼**: í† í° ê²€ì¦ ì‹¤íŒ¨ ì‹œì—ë„ storage ì„ íƒìœ¼ë¡œ ë³µê·€í•˜ì—¬ ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ì˜µì…˜ ì„ íƒ ê°€ëŠ¥

## Enhancements

### Setup Wizardì˜ Gist ë³´ì•ˆ ì„¤ëª… ì¶”ê°€
ì‚¬ìš©ìê°€ Gist ì˜µì…˜ì„ ì„ íƒí•  ë•Œ í† í° ë³´ì•ˆì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª… í‘œì‹œ:

**Benefits ì„¹ì…˜ì— Security ì¶”ê°€**:
```
Security:
  â€¢ Your GitHub token is automatically stored in OS keyring
  â€¢ Tokens are encrypted by your system (macOS Keychain, Windows Credential Manager, Linux Secret Service)
  â€¢ Fallback to secure file storage (permissions 600) if keyring unavailable
```

**í† í° ì…ë ¥ í™”ë©´ì— ë³´ì•ˆ ì•ˆë‚´**:
```
ğŸ” Your token will be securely stored in your system's keyring

Enter your GitHub token:
```

**í† í° ì €ì¥ í›„ ìœ„ì¹˜ í‘œì‹œ**:
```
âœ“ Token saved securely
  Storage: System keyring (encrypted)
```

### ë©”ì‹œì§€ ëª…í™•í™”
'n' (skip) ì„ íƒ ì‹œ ë©”ì‹œì§€ ê°œì„ :
```python
# Before
console.print("[yellow]Skipping Gist setup[/yellow]")
console.print("[dim]You can configure it later with: ccu gist setup[/dim]")

# After
console.print("[yellow]Skipping Gist setup - using local storage instead[/yellow]")
console.print("[dim]You can add Gist backup later with: ccu gist setup[/dim]")
```

## User Experience Flow

### Before (v1.3.6)
```
1. User selects "GitHub Gist"
2. User presses Ctrl+C during token input
3. âŒ Setup proceeds with OneDrive storage (unexpected)
```

```
1. User selects "GitHub Gist"
2. User presses Enter (no token)
3. âŒ Setup proceeds with local storage (silent fallback)
```

### After (v1.3.7)
```
1. User selects "GitHub Gist"
2. User presses Ctrl+C during token input
3. âœ… "Gist setup cancelled. Please select a different storage option."
4. âœ… Returns to Step 1 (storage selection)
5. User can select Local, OneDrive, or Custom Path
```

```
1. User selects "GitHub Gist"
2. User presses Enter (no token)
3. âœ… "No token provided. Cannot proceed with Gist storage."
4. âœ… Returns to Step 1 (storage selection)
```

```
1. User selects "GitHub Gist"
2. User presses 'n' (skip)
3. âœ… "Skipping Gist setup - using local storage instead"
4. âœ… Proceeds to Step 2 with local storage (as intended)
```

## Technical Changes

### Files Modified

1. **`src/commands/setup_wizard.py`**
   - Line 193-196: Gist cancellation now returns to storage selection (recursive call)
   - Line 234-237: Added Security section to Benefits display
   - Line 288: Added token security message before input
   - Line 299-300: Empty token returns None (cancel) instead of False (skip)
   - Line 312-313: Invalid token returns None instead of False
   - Line 317-318: Validation error returns None instead of False
   - Line 260-261: Clarified skip message ("using local storage instead")
   - Line 322-323: Shows storage location after token is saved

2. **`pyproject.toml`**
   - Version: 1.3.6 â†’ 1.3.7

3. **`src/commands/usage.py`**
   - Line 59: Version string updated to "1.3.7"

## Return Value Semantics

`_setup_gist_sync()` ë°˜í™˜ê°’ì˜ ì˜ë¯¸:

| Return Value | Meaning | Next Action |
|--------------|---------|-------------|
| `True` | Gist setup ì„±ê³µ | Step 2ë¡œ ì§„í–‰ (local DB + Gist backup) |
| `False` | Skip (ì‚¬ìš©ìê°€ 'n' ì„ íƒ) | Step 2ë¡œ ì§„í–‰ (local DB only) |
| `None` | Cancel (Ctrl+C, í† í° ì—†ìŒ, ì˜ëª»ëœ í† í°) | Step 1ë¡œ ë³µê·€ (storage ì¬ì„ íƒ) |

## Breaking Changes

**None**. ê¸°ì¡´ ë™ì‘ì€ ìœ ì§€ë˜ë©°, ë²„ê·¸ë§Œ ìˆ˜ì •ë¨.

## Migration Guide

ë§ˆì´ê·¸ë ˆì´ì…˜ ë¶ˆí•„ìš”. ê¸°ì¡´ ì„¤ì¹˜ëŠ” ê³„ì† ì‘ë™.

ìƒˆ ì„¤ì¹˜ ì‹œ:
- Gist ì„¤ì • ì·¨ì†Œê°€ ë” ì§ê´€ì ìœ¼ë¡œ ì‘ë™
- í† í° ë¬¸ì œ ë°œìƒ ì‹œ ë‹¤ë¥¸ storage ì˜µì…˜ ì„ íƒ ê°€ëŠ¥

## Use Cases

### Case 1: Gist ì„ íƒí–ˆì§€ë§Œ í† í°ì´ ì—†ìŒ
```
User: "Gistë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì§€ë§Œ ì§€ê¸ˆ í† í°ì´ ì—†ë„¤..."
Before: Local storageë¡œ ìë™ ì§„í–‰ (í˜¼ë€)
After: Storage ì„ íƒìœ¼ë¡œ ë³µê·€ â†’ OneDriveë‚˜ Local ì„ íƒ ê°€ëŠ¥
```

### Case 2: Gist í† í° ì…ë ¥ ì¤‘ ì‹¤ìˆ˜ë¡œ Ctrl+C
```
User: "ì•—, ì˜ëª» ëˆŒë €ëŠ”ë°..."
Before: OneDriveë¡œ ìë™ ì§„í–‰ (ì˜ˆìƒ ë°–)
After: Storage ì„ íƒìœ¼ë¡œ ë³µê·€ â†’ ë‹¤ì‹œ Gist ì„ íƒ ê°€ëŠ¥
```

### Case 3: Gist í† í°ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì˜ëª»ë¨
```
User: "í† í°ì´ ì•ˆ ë§ë„¤..."
Before: Local storageë¡œ ìë™ ì§„í–‰
After: Storage ì„ íƒìœ¼ë¡œ ë³µê·€ â†’ ìƒˆ í† í° ì¤€ë¹„ í›„ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì˜µì…˜ ì„ íƒ
```

### Case 4: ì§€ê¸ˆì€ Gist ì„¤ì • ì•ˆ í•˜ê³  ë‚˜ì¤‘ì— í•˜ê¸°
```
User: "ë‚˜ì¤‘ì— ì„¤ì •í• ë˜"
Before: 'n' ì„ íƒ â†’ Local storage (ì˜ë„ëœ ë™ì‘)
After: 'n' ì„ íƒ â†’ Local storage (ë™ì¼, ë©”ì‹œì§€ë§Œ ëª…í™•í•´ì§)
```

## Testing Recommendations

1. **Gist ì·¨ì†Œ í…ŒìŠ¤íŠ¸**:
   ```
   1. Run ccu (first time)
   2. Select "GitHub Gist"
   3. Press Ctrl+C during token input
   4. Verify: Returns to Step 1 (storage selection)
   5. Select different option (Local/OneDrive)
   6. Verify: Setup completes successfully
   ```

2. **í† í° ë¯¸ì…ë ¥ í…ŒìŠ¤íŠ¸**:
   ```
   1. Run ccu (first time)
   2. Select "GitHub Gist"
   3. Press 'y' (yes, setup now)
   4. Press Enter (no token)
   5. Verify: Returns to Step 1
   6. Select Local storage
   7. Verify: Setup completes with local storage
   ```

3. **ì˜ëª»ëœ í† í° í…ŒìŠ¤íŠ¸**:
   ```
   1. Run ccu (first time)
   2. Select "GitHub Gist"
   3. Press 'y'
   4. Enter invalid token (e.g., "abc123")
   5. Verify: "Invalid token" error
   6. Verify: Returns to Step 1
   7. Select OneDrive
   8. Verify: Setup completes with OneDrive
   ```

4. **Skip í…ŒìŠ¤íŠ¸** (ê¸°ì¡´ ë™ì‘ í™•ì¸):
   ```
   1. Run ccu (first time)
   2. Select "GitHub Gist"
   3. Press 'n' (skip)
   4. Verify: "using local storage instead"
   5. Verify: Proceeds to Step 2
   6. Verify: Setup completes with local storage
   ```

## Known Issues

None reported.

## Compatibility

- **Python**: 3.10+
- **Dependencies**: No changes
- **Platforms**: Linux (WSL2), macOS, Windows (native)

## Future Improvements

- Add "retry token input" option instead of returning to storage selection
- Remember last selected storage option if user cancels and retries
- Add token validation preview before full setup
- Allow editing token in Settings menu
