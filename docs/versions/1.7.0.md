# Version 1.7.0

**Release Date:** 2025-11-15

## ğŸš€ New Features

### Claude Code Usage ì¿¼ë¦¬ ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 

Claude Codeê°€ ì¼ì‹œì ìœ¼ë¡œ usage ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì„ ë•Œ ëŒ€ì‹œë³´ë“œê°€ ê³„ì† ì‘ë™í•˜ë„ë¡ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

**ì´ì „ ë™ì‘:**
- Claude Code `/usage` ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ ì—†ì´ limits ë°ì´í„°ë§Œ ëˆ„ë½
- ì‚¬ìš©ìê°€ ë¬¸ì œë¥¼ ì¸ì§€í•˜ê¸° ì–´ë ¤ì›€

**ìƒˆë¡œìš´ ë™ì‘:**
1. **Untrusted folder ì—ëŸ¬**: ëª…í™•í•œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ í›„ í”„ë¡œê·¸ë¨ ì¢…ë£Œ
2. **Claude server ì—ëŸ¬**: Footerì— ê²½ê³  í‘œì‹œ, ëŒ€ì‹œë³´ë“œëŠ” ê³„ì† ì‹¤í–‰

## ğŸ› Bug Fixes

### 1. Untrusted Folder ê°ì§€ ë¡œì§ ê°œì„ 

**ë¬¸ì œ:**
- ì‹ ë¢°ëœ í”„ë¡œì íŠ¸ í´ë”ì—ì„œ `ccu` ì‹¤í–‰ ì‹œì—ë„ "Limits update failed" ë°œìƒ
- ì›ì¸: `capture_limits()` í•¨ìˆ˜ê°€ í™ˆ ë””ë ‰í† ë¦¬ì—ì„œ `claude /usage` ì‹¤í–‰

**í•´ê²°:**
- Working directoryë¥¼ í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬ë¡œ ë³€ê²½
- `cwd=os.path.expanduser('~')` â†’ `cwd=os.getcwd()`

### 2. ì—ëŸ¬ íƒ€ì… êµ¬ë¶„ ë¡œì§ ì¶”ê°€

**êµ¬í˜„:**
```python
# Untrusted folder: trust prompt í‘œì‹œë¨
if 'Do you trust' in output or 'Do you want to work in this folder' in output:
    return {"error": "untrusted_folder", ...}

# Server error: ë°”ë¡œ ì—ëŸ¬ ë©”ì‹œì§€ë§Œ í‘œì‹œ
else:
    return {"error": "claude_server_error", ...}
```

### 3. Footer ê²½ê³  ì„¹ì…˜ ì¶”ê°€

Footer í•˜ë‹¨ì— ì—ëŸ¬/ê²½ê³  ìƒíƒœë¥¼ í•­ìƒ í‘œì‹œ:

```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸  Claude Code Usage ì¿¼ë¦¬ ì‹¤íŒ¨ (ì„œë²„/ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ) â”‚ âš ï¸  Gist ë¯¸ë™ê¸°í™” â”‚
```

**í‘œì‹œë˜ëŠ” ê²½ê³ :**
- Claude Code Usage ì¿¼ë¦¬ ì‹¤íŒ¨ (ì„œë²„/ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ) - ë…¸ë€ìƒ‰
- Gist ë™ê¸°í™” ì‹¤íŒ¨ - ë¹¨ê°„ìƒ‰
- Gist ë¯¸ë™ê¸°í™” - ë…¸ë€ìƒ‰ (auto-sync í™œì„±í™” ì‹œ)

## ğŸ”§ Technical Implementation

### limits.py ë³€ê²½ì‚¬í•­

**Working Directory ìˆ˜ì •:**
```python
# Before (v1.6.1)
process = subprocess.Popen(
    ['claude', '/usage'],
    cwd=os.path.expanduser('~')  # Always home directory
)

# After (v1.7.0)
process = subprocess.Popen(
    ['claude', '/usage'],
    cwd=os.getcwd()  # Current working directory
)
```

**ì—ëŸ¬ íƒ€ì… êµ¬ë¶„:**
```python
if 'Error: Failed to load usage data' in clean_output:
    # Check for trust prompt to distinguish error type
    if 'Do you trust' in clean_output or 'Do you want to work in this folder' in clean_output:
        return {"error": "untrusted_folder", ...}
    else:
        return {"error": "claude_server_error", ...}
```

### usage.py ë³€ê²½ì‚¬í•­

**Untrusted Folder ì—ëŸ¬:**
```python
if limits.get("error") == "untrusted_folder":
    # Show detailed guidance message
    console.print(Panel(error_msg, ...))
    return  # Exit program
```

**Claude Server ì—ëŸ¬:**
```python
elif limits.get("error") == "claude_server_error":
    # Don't show fullscreen error
    # Just keep error in limits for footer display
    pass
```

### dashboard.py ë³€ê²½ì‚¬í•­

**Footer ê²½ê³  ì„¹ì…˜:**
```python
# Add error/warning status at the bottom
warnings = []

# Check for Claude Code usage query error
if limits_from_db and limits_from_db.get("error") == "claude_server_error":
    warnings.append(("âš ï¸  Claude Code Usage ì¿¼ë¦¬ ì‹¤íŒ¨ (ì„œë²„/ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ)", "bold yellow"))

# Check for Gist sync status
if view_mode_ref and view_mode_ref.get('sync_status'):
    sync_status = view_mode_ref['sync_status']
    if sync_status.get('error'):
        warnings.append(("âš ï¸  Gist ë™ê¸°í™” ì‹¤íŒ¨", "bold red"))
    elif not sync_status.get('last_sync'):
        warnings.append(("âš ï¸  Gist ë¯¸ë™ê¸°í™”", "bold yellow"))

# Display warnings in footer
if warnings:
    footer.append("\n" + "â”€" * 80 + "\n")
    for warning_text, warning_style in warnings:
        footer.append(warning_text, style=warning_style)
        footer.append(" â”‚ ")
```

## ğŸ“ Changed Files

- `src/commands/limits.py`:
  - Working directory ìˆ˜ì • (line 51)
  - ì—ëŸ¬ íƒ€ì… êµ¬ë¶„ ë¡œì§ ì¶”ê°€ (lines 171-187)

- `src/commands/usage.py`:
  - Untrusted folder ì—ëŸ¬ ì²˜ë¦¬ (lines 1409-1433)
  - Claude server ì—ëŸ¬ ì²˜ë¦¬ (lines 1436-1439)

- `src/visualization/dashboard.py`:
  - Footerì— `limits_from_db` íŒŒë¼ë¯¸í„° ì¶”ê°€ (line 4073)
  - ê²½ê³  ì„¹ì…˜ í‘œì‹œ ë¡œì§ ì¶”ê°€ (lines 4493-4527)
  - ëª¨ë“  `_create_footer()` í˜¸ì¶œì— `limits_from_db` ì „ë‹¬ (lines 710, 783, 1274, 1295)

- `pyproject.toml`:
  - ë²„ì „ 1.6.1 â†’ 1.7.0

## ğŸ”„ Migration Notes

ì´ ë²„ì „ì€ í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ ì§€í•©ë‹ˆë‹¤.

**ì—…ê·¸ë ˆì´ë“œ ë°©ë²•:**
```bash
# Pipx ì‚¬ìš© ì‹œ
pipx upgrade claude-code-usage-analytics

# ë˜ëŠ” ê°œë°œ ëª¨ë“œ ì¬ì„¤ì¹˜
cd /path/to/claude-code-usage-analytics
pipx install -e . --force
```

**ë³€ê²½ì‚¬í•­:**
- Untrusted folderì—ì„œ ì‹¤í–‰ ì‹œ ëª…í™•í•œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ í›„ ì¢…ë£Œ
- Claude server ì—ëŸ¬ ì‹œ footerì— ê²½ê³  í‘œì‹œí•˜ë©° ëŒ€ì‹œë³´ë“œ ê³„ì† ì‹¤í–‰
- ê¸°ì¡´ ë™ì‘ì— ì˜í–¥ ì—†ìŒ

## ğŸ’¡ Usage Tips

**Claude Code Usage ì¿¼ë¦¬ ì‹¤íŒ¨ ì‹œ:**

1. **ì¼ì‹œì  ë¬¸ì œì¸ ê²½ìš°:**
   - Footerì— "âš ï¸ Claude Code Usage ì¿¼ë¦¬ ì‹¤íŒ¨" í‘œì‹œ
   - ëŒ€ì‹œë³´ë“œëŠ” ì •ìƒ ì‘ë™ (limits ë°ì´í„°ë§Œ ëˆ„ë½)
   - ëª‡ ë¶„ í›„ ìë™ìœ¼ë¡œ ë³µêµ¬ ì‹œë„

2. **Untrusted folder ë¬¸ì œì¸ ê²½ìš°:**
   ```bash
   # í•´ê²° ë°©ë²• 1: ë¨¼ì € Claude Codeë¡œ í´ë” ì‹ ë¢°
   claude
   # "Yes, continue" ì„ íƒ

   # ê·¸ í›„ ccu ì‹¤í–‰
   ccu

   # í•´ê²° ë°©ë²• 2: ì‹ ë¢°ëœ í”„ë¡œì íŠ¸ í´ë”ì—ì„œ ì‹¤í–‰
   cd ~/projects/my-project
   ccu
   ```

**Gist ë™ê¸°í™” ê²½ê³ :**
- "âš ï¸ Gist ë™ê¸°í™” ì‹¤íŒ¨": Settings â†’ Gist Sync â†’ Pull/Push ì¬ì‹œë„
- "âš ï¸ Gist ë¯¸ë™ê¸°í™”": Auto-sync í™œì„±í™” ìƒíƒœì—ì„œ í•œ ë²ˆë„ ë™ê¸°í™” ì•ˆ ë¨

## ğŸ¯ Related Issues

ì´ ë¦´ë¦¬ìŠ¤ëŠ” ë‹¤ìŒ ì‚¬ìš©ì í”¼ë“œë°±ì„ ë°˜ì˜í•©ë‹ˆë‹¤:

1. **Claude Code usage ì¿¼ë¦¬ ì—ëŸ¬ ë°œìƒ ì‹œ ì•ˆë‚´ ë¶€ì¡±**
   - í•´ê²°: Footerì— ëª…í™•í•œ ê²½ê³  í‘œì‹œ

2. **ì‹ ë¢°ëœ í´ë”ì—ì„œë„ "Limits update failed" ë°œìƒ**
   - í•´ê²°: Working directoryë¥¼ í˜„ì¬ ë””ë ‰í† ë¦¬ë¡œ ë³€ê²½

3. **ì¼ì‹œì  ì„œë²„ ë¬¸ì œ ì‹œ í”„ë¡œê·¸ë¨ ê³„ì† ì‚¬ìš©í•˜ê³  ì‹¶ìŒ**
   - í•´ê²°: Server ì—ëŸ¬ ì‹œ ëŒ€ì‹œë³´ë“œ ê³„ì† ì‹¤í–‰

## ğŸ” Debug Information

**ì—ëŸ¬ ë°œìƒ ì‹œ debug íŒŒì¼:**
- ìœ„ì¹˜: `/tmp/tmp*_claude_usage_debug.txt`
- ë‚´ìš©: Claude Code `/usage` ëª…ë ¹ì–´ì˜ raw output
- ìš©ë„: ë¬¸ì œ ì§„ë‹¨ ë° ë²„ê·¸ ë¦¬í¬íŠ¸

Footerì— í‘œì‹œë˜ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ì—ëŠ” debug íŒŒì¼ ê²½ë¡œê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šì§€ë§Œ, Settings â†’ Statusì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## ğŸš§ Known Limitations

1. **Gist Sync vs OneDrive DB Sync í˜¼ë™:**
   - GistëŠ” ìš”ì•½ ë°ì´í„°ë§Œ sync (ì „ì²´ DB ì•„ë‹˜)
   - OneDriveëŠ” DB ì „ì²´ íŒŒì¼ sync
   - í–¥í›„ ë²„ì „ì—ì„œ ëª…í™•í•œ ì„¤ëª… ì¶”ê°€ ì˜ˆì •

2. **Claude Code server ë¬¸ì œ ê°ì§€:**
   - Trust prompt ì—†ì´ ì—ëŸ¬ë§Œ í‘œì‹œë˜ë©´ server ë¬¸ì œë¡œ ê°„ì£¼
   - ë‹¤ë¥¸ ì—ëŸ¬ ì¼€ì´ìŠ¤ë„ server ë¬¸ì œë¡œ ë¶„ë¥˜ë  ìˆ˜ ìˆìŒ

## ğŸ“Š Version Comparison

| Feature | v1.6.1 | v1.7.0 |
|---------|---------|---------|
| Untrusted folder ê°ì§€ | âŒ Homeì—ì„œ ì‹¤í–‰ | âœ… í˜„ì¬ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰ |
| Server ì—ëŸ¬ ì²˜ë¦¬ | âŒ ê²½ê³  ì—†ìŒ | âœ… Footer ê²½ê³  í‘œì‹œ |
| Gist ë™ê¸°í™” ìƒíƒœ | âš ï¸ ìƒë‹¨ í‘œì‹œë§Œ | âœ… Footer ê²½ê³  ì¶”ê°€ |
| ì—ëŸ¬ ì‹œ í”„ë¡œê·¸ë¨ ë™ì‘ | âš ï¸ ë¶ˆëª…í™• | âœ… ì—ëŸ¬ íƒ€ì…ë³„ ì²˜ë¦¬ |
