# Version 1.3.6

**Release Date**: 2025-10-22

## New Features

### Program Information Display at Startup
- **Version display** at dashboard launch
- **Storage mode indicator** with icons (☁️ OneDrive/iCloud, 💾 Local, 📁 Custom)
- **Machine name** and **session count** shown at startup
- Example: "Claude Code Usage Analytics v1.3.6 • ☁️ Storage: OneDrive Sync • Machine: Laptop-WT • Sessions: 15"

### Automated Program Reset
- **New command**: `ccu reset` for complete program reset
- **Settings integration**: `[r] Program Reset` option in Settings menu
- Deletes all configuration and triggers setup wizard on next run
- Shows detailed information about what will be deleted and preserved

### Settings Menu Integration
Complete integration of CLI commands into Settings menu with keyboard shortcuts:

- **`[e] Gist Setup`** - Configure GitHub token & sync
- **`[f] Gist Sync`** - Push/Pull/Status submenu
- **`[p] Database Info`** - Detailed database statistics
- **`[o] Reset Database`** - Delete DB only (keep config)
- **`[r] Program Reset`** - Complete reset with setup wizard restart

Each option includes:
- Storage-mode-aware messaging
- Actual file paths being affected
- Clear distinction between preserved and deleted items

### Enhanced Reset Messages
All reset functions now display:
- **Actual file paths** being deleted (not generic descriptions)
- **Storage mode detection** (OneDrive/iCloud/Local/Custom)
- **Preserved items** including Claude Code data and Gist backups
- **Context-aware warnings** based on current storage configuration

Example reset message:
```
삭제될 항목:
  • 설정 폴더: /home/user/.claude/claude-goblin-mod
    - claude-goblin.json
  • 데이터베이스 (OneDrive Sync)
    /mnt/d/OneDrive/.claude-goblin/usage_history.db

보존되는 항목:
  • Claude Code usage 원본 데이터
    /home/user/.claude/projects/*.jsonl
  • GitHub Gist 클라우드 백업 (기존 Gist는 유지됨)
```

## Documentation Improvements

### Token Security Documentation
Comprehensive token security explanation added to README:

**New Section**: 🔐 Token Security
- Explains 3-tier automatic system
- OS-specific details (macOS Keychain, Windows Credential Manager, Linux Secret Service)
- Fallback mechanism to secure file storage
- No manual configuration needed

**Installation TIP Boxes**:
All installation methods now emphasize:
```
자동 포함되는 보안 기능:
설치 시 `keyring` 라이브러리가 자동으로 포함되어 GitHub Gist 토큰을
OS 보안 저장소에 안전하게 보관합니다. 별도 설치나 설정이 필요 없습니다!
```

**New FAQ Section**: Security & Token Management
- "토큰은 어디에 저장되나요?"
- "keyring이 작동하지 않으면?"
- "토큰을 다시 확인할 수 있나요?"

### Dependencies Synchronization
- Added `keyring>=24.0.0` to `requirements.txt` (was only in pyproject.toml)
- Added `requests>=2.31.0` to `requirements.txt`
- All installation methods now have identical dependencies

## Bug Fixes

### Settings Menu Exit Prompt Fix
**Problem**: `_read_key()` function was not working reliably in Settings menu prompts.

**Solution**: Replaced all `_read_key()` calls with standard `input()`:
- Gist Setup completion
- Gist Sync operations
- Database Info display
- Database Reset
- Program Reset

Changed prompts from "아무 키나 누르세요" to "Enter를 눌러 돌아가기"

### Program Reset Exit Issue
**Problem**: After Program Reset, pressing any key would not exit the program.

**Solution**: Changed to require Ctrl+C for exit:
```python
console.print("[yellow]Ctrl+C를 눌러 프로그램을 종료하세요...[/yellow]")
try:
    while True:
        input()  # Wait indefinitely until Ctrl+C
except KeyboardInterrupt:
    console.print("\n[dim]프로그램을 종료합니다...[/dim]")
    sys.exit(0)
```

This prevents the program from hanging in the Settings menu loop.

## Technical Changes

### Files Modified
1. **`src/commands/usage.py`**
   - Added `_display_program_info()` function (lines 46-85)
   - Shows version, storage mode with icon, machine name, session count
   - Detects storage mode from DB path

2. **`src/commands/settings.py`**
   - Added `_gist_setup()` - [e] Gist Setup (lines 1408-1503)
   - Added `_gist_sync_menu()` - [f] Gist Sync submenu (lines 1506-1593)
   - Added `_show_database_info()` - [p] Database Info (lines 1596-1668)
   - Added `_reset_database()` - [o] Reset Database (lines 1671-1790)
   - Added `_program_reset()` - [r] Program Reset (lines 1793-1930)
   - Replaced all `_read_key()` with `input()` for reliability
   - Added storage mode detection throughout

3. **`src/commands/gist_cmd.py`**
   - Updated warning message (lines 34-39)
   - Changed from "Keyring library not installed" to "Keyring 백엔드를 사용할 수 없습니다"
   - Suggests environment variable instead of pip install

4. **`src/cli.py`**
   - Added `reset` import (line 14)
   - Added `reset` command handler (lines 77-85)

5. **`README.md`**
   - Added TIP boxes to all installation sections
   - Rewrote "Token Security" section (lines 454-516)
   - Added "Security & Token Management" FAQ (lines 756-789)
   - Updated Settings Mode description (lines 201-231)
   - Updated Additional Commands section (lines 409-438)

6. **`requirements.txt`**
   - Added `keyring>=24.0.0`
   - Added `requests>=2.31.0`

### Files Created
1. **`src/commands/reset.py`** - CLI command for automated program reset

## UI/UX Improvements

### Storage Mode Icons
- ☁️ OneDrive Sync / iCloud Sync
- 💾 Local Storage
- 📁 Custom Path

### Consistent Messaging
All reset operations now follow the same message structure:
1. What will be deleted (with actual paths)
2. What will be preserved (Claude Code data, Gist backups)
3. What happens after reset
4. Storage-specific warnings (e.g., "다른 PC도 동일하게 재구축됩니다" for cloud sync)

### Settings Menu Layout
Added section headers for better organization:
```
───  Gist & Database  ─────────────────
[e]  Gist Setup              Configure GitHub token & sync
[f]  Gist Sync               Push/Pull data to/from Gist
[p]  Database Info            Show detailed statistics
[o]  Reset Database           Delete DB only (keep config)
[r]  Program Reset            Reset all settings & config
```

## Breaking Changes

**None**. All changes are additive or bug fixes.

## Migration Guide

No migration needed. Existing installations will continue to work.

New features available immediately:
- Program info display appears automatically on next run
- Settings menu enhancements accessible via `s` key in dashboard
- `ccu reset` command available immediately

## Known Issues

None reported.

## Compatibility

- **Python**: 3.10+
- **Dependencies**: `keyring>=24.0.0` now required in all installation methods
- **Platforms**: Linux (WSL2), macOS, Windows (native)

## Future Improvements

- Auto-detect version from pyproject.toml (currently hardcoded)
- Additional storage mode options
- More granular reset options (e.g., "reset config only", "reset cache only")
