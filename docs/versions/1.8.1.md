# Version 1.8.1

**Release Date:** 2025-11-29
**Focus:** --force 플래그 동작 수정 - 전체 데이터 export 트리거

## Overview

v1.8.1은 `ccu gist push --force` 플래그가 의도한 대로 전체 데이터를 export하도록 수정한 버전입니다. v1.8.0에서 daily_snapshots 지원을 추가했지만, --force 플래그가 실제로 전체 export를 트리거하지 않는 버그가 있었습니다.

## 문제점

### v1.8.0의 --force 동작

**기대 동작:**
- `--force`: 전체 데이터 export + conflict check 스킵

**실제 동작:**
- `--force`: conflict check만 스킵, incremental export 유지

**코드 분석:**
```python
# gist_cmd.py (v1.8.0)
stats = sync_manager.push(
    force=export_all,           # --force가 여기에 매핑 안 됨!
    create_backup=backup,
    skip_conflict_check=force   # --force는 여기에만 매핑
)
```

**결과:**
- `ccu gist push --force` 실행해도 incremental export만 됨
- 사용자가 전체 데이터를 업로드하려면 `--export-all` 플래그를 별도로 사용해야 함

## 주요 변경사항

### 1. --force 플래그 동작 수정

**파일:** `src/commands/gist_cmd.py`

**Before (v1.8.0):**
```python
stats = sync_manager.push(
    force=export_all,           # --export-all만 전체 export 트리거
    create_backup=backup,
    skip_conflict_check=force   # --force는 conflict skip만
)
```

**After (v1.8.1):**
```python
stats = sync_manager.push(
    force=export_all or force,  # --force도 전체 export 트리거!
    create_backup=backup,
    skip_conflict_check=force
)
```

### 2. 플래그 의미 정리

| 플래그 | 전체 export | conflict 스킵 | 용도 |
|--------|-------------|---------------|------|
| (없음) | ❌ | ❌ | 일상적 incremental sync |
| `--export-all` | ✅ | ❌ | 전체 데이터 export, conflict 체크 유지 |
| `--force` | ✅ | ✅ | 강제 덮어쓰기 (데이터 손실 가능) |

## 파일 변경 목록

```
src/commands/gist_cmd.py
  - push(): force 파라미터에 `export_all or force` 전달
```

## 업그레이드 노트

### 설치
```bash
pip install -e . --break-system-packages
# 또는
pipx install -e . --force
```

### 데이터 복구 (v1.8.0에서 업그레이드 시)

v1.8.0에서 `--force`로 push했지만 전체 데이터가 업로드되지 않은 경우:

1. v1.8.1로 업그레이드
2. `ccu gist push --force` 다시 실행
3. 전체 데이터 (usage_records + daily_snapshots) 업로드 확인

### 테스트 결과

```
HOME-WT에서 테스트:
- Records exported: 107,168
- Daily snapshots: 포함됨
- Files uploaded: 2 (연도별 chunked)
```

## 호환성

- Python: 3.10+
- v1.8.0과 완전 호환 (동작 수정만)
- 기존 Gist 데이터: 영향 없음

## Known Issues

- 없음

## Next Steps

- v1.9.0: 자동 동기화 기능 (auto-sync on startup)
