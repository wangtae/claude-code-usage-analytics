# Version 1.4.1

**Release Date:** 2025-10-23
**Focus:** Complete weekly view Opus reset time fix (patch release)

## Overview

v1.4.0에서 usage 모드의 Opus 권장 사용률 계산을 수정했지만, weekly 모드가 누락되었습니다. 이번 패치 릴리스는 weekly 모드에도 동일한 수정사항을 적용하여 모든 뷰 모드에서 Opus가 독립적인 리셋 시각을 사용하도록 완성합니다.

## 주요 변경사항

### Weekly View에 Opus 독립 리셋 시각 적용

**문제점:**
- v1.4.0에서 usage 모드만 수정되고 weekly 모드가 누락됨
- weekly 모드 (`[w]eekly`)에서 Opus가 여전히 `weekly_recommended_pct` 사용
- Current week (all models)와 Current week (Opus)가 서로 다른 리셋 시각임에도 동일한 권장 바 표시

**해결:**
- weekly 모드에 `opus_recommended_pct` 계산 로직 추가
- Opus 바가 `opus_reset` 기반의 독립적인 권장 사용률 사용
- v1.4.0과 동일한 수정사항을 weekly 모드에도 적용

**파일 변경:**
- `src/visualization/dashboard.py`: weekly 모드 Opus 권장 사용률 독립 처리 (1513-1516, 1565-1573번 줄)

**효과:**
- Usage 모드 ([u]sage): ✅ v1.4.0에서 수정됨
- Weekly 모드 ([w]eekly): ✅ v1.4.1에서 수정됨
- 모든 뷰 모드에서 Opus 권장 진행률이 올바르게 표시됨

---

## 기술적 세부사항

### v1.4.0에서 놓친 부분

v1.4.0에서는 usage 모드(`view_mode == "usage"`)의 4가지 디스플레이 모드(M1, M2, M3, M4)만 수정했습니다:
```python
# usage 모드에서만 수정됨 (v1.4.0)
if view_mode == "usage":
    # ... (680-683번 줄)
    opus_recommended_pct = 0
    if limits.get('opus_reset'):
        opus_recommended_pct = _calculate_weekly_recommended_pct(limits['opus_reset'], weekly_days)
```

하지만 weekly 모드(`view_mode == "weekly"`)에는 별도의 limits 표시 로직이 있어서 수정이 누락되었습니다.

### v1.4.1 수정사항

Weekly 모드의 limits 표시 부분에 동일한 로직 추가:

**Before (v1.4.0):**
```python
# weekly 모드 (1508-1511번 줄)
# Parse week reset time to calculate elapsed days
weekly_recommended_pct = 0
if limits.get('week_reset'):
    weekly_recommended_pct = _calculate_weekly_recommended_pct(limits['week_reset'], weekly_days)

# ❌ opus_recommended_pct 계산 없음

# Opus bar (1560-1564번 줄)
# Opus uses same weekly recommended percentage as "all models"  ❌
if weekly_recommended_pct > 0:
    opus_bar = _create_usage_bar_with_recommended(
        limits["opus_pct"],
        weekly_recommended_pct,  # ❌ 잘못된 값
        ...
    )
```

**After (v1.4.1):**
```python
# weekly 모드 (1508-1516번 줄)
# Parse week reset time to calculate elapsed days
weekly_recommended_pct = 0
if limits.get('week_reset'):
    weekly_recommended_pct = _calculate_weekly_recommended_pct(limits['week_reset'], weekly_days)

# ✅ opus_recommended_pct 계산 추가
# Parse opus reset time to calculate elapsed days (separate from week reset)
opus_recommended_pct = 0
if limits.get('opus_reset'):
    opus_recommended_pct = _calculate_weekly_recommended_pct(limits['opus_reset'], weekly_days)

# Opus bar (1565-1573번 줄)
# Opus uses its own reset time (opus_reset) which may differ from week_reset  ✅
if opus_recommended_pct > 0:
    opus_bar = _create_usage_bar_with_recommended(
        limits["opus_pct"],
        opus_recommended_pct,  # ✅ 올바른 값
        ...
    )
```

---

## 실제 사용 예시

### Weekly 모드에서의 표시

**Before (v1.4.0):**
```
Current week (all models)
███████████████████████████████████░░░░░░░░░░░░░░░░░░░░░ 67%
Resets 9:59am (Asia/Seoul) ($246.95)

Current week (Opus)
████████████████████████████████████░░░░░░░░░░░░░░░░░░░ 100%  ❌ 동일한 권장 바
Resets Oct 27, 11:59am (Asia/Seoul) ($99.97)
```

**After (v1.4.1):**
```
Current week (all models)
███████████████████████████████████░░░░░░░░░░░░░░░░░░░░░ 67%
Resets 9:59am (Asia/Seoul) ($246.95)

Current week (Opus)
█████████████████████░░░░░■■■■■■■■■■■■■■■■■■■■■■■■■■■■■ 100%  ✅ 독립적인 권장 바
Resets Oct 27, 11:59am (Asia/Seoul) ($99.97)
```

범례:
- `█` (파란색): 현재 사용량
- `░` (회색): 권장 사용 범위
- `■` (빨간색): 권장 초과 사용량

---

## 커밋 내역

### 1ccecc8 - Fix: Apply separate Opus reset time to weekly view mode

- weekly 모드에 opus_recommended_pct 계산 추가
- Opus 바를 opus_recommended_pct 사용으로 변경 (weekly_recommended_pct에서)
- weekly 모드에서 잘못된 권장 바 표시 문제 수정

**변경 전:** Weekly 모드 Opus가 weekly_recommended_pct 사용 (all models와 동일)
**변경 후:** Weekly 모드 Opus가 opus_recommended_pct 사용 (독립적인 reset time)

**영향받은 파일:**
- `src/visualization/dashboard.py`:
  - opus_recommended_pct 계산 추가 (1513-1516번 줄)
  - Opus 바 수정 (1565-1573번 줄)

---

## 뷰 모드별 Opus 독립 리셋 적용 현황

| 뷰 모드 | Limits 표시 | Opus 독립 리셋 | 수정 버전 |
|---------|-------------|----------------|-----------|
| Usage ([u]sage) | ✅ | ✅ | v1.4.0 |
| Weekly ([w]eekly) | ✅ | ✅ | v1.4.1 |
| Monthly ([m]onthly) | ❌ | N/A | - |
| Yearly ([y]early) | ❌ | N/A | - |
| Heatmap ([h]eatmap) | ❌ | N/A | - |
| Devices ([d]evices) | ❌ | N/A | - |

**결론:** Limits를 표시하는 모든 뷰 모드(Usage, Weekly)에서 Opus 독립 리셋 시각 적용 완료 ✅

---

## 사용자 영향

### 1. 완전한 수정
- v1.4.0: usage 모드만 수정
- v1.4.1: weekly 모드도 수정 → **완전한 해결**

### 2. 일관된 경험
- 모든 뷰 모드에서 동일한 권장 사용률 로직 적용
- 사용자가 뷰를 전환해도 일관된 정보 제공

### 3. 정확한 진행 상황 파악
- Weekly 모드에서도 Opus의 정확한 권장 사용률 확인 가능
- 리셋 시각이 다른 두 한도를 명확히 구분

---

## v1.4.0 → v1.4.1 변경 요약

| 항목 | v1.4.0 | v1.4.1 |
|------|--------|--------|
| Usage 모드 Opus | ✅ 독립 리셋 | ✅ 독립 리셋 |
| Weekly 모드 Opus | ❌ 공유 리셋 | ✅ 독립 리셋 |
| 파일 변경 | 1개 파일 | 1개 파일 |
| 커밋 수 | 1개 | 1개 |
| 릴리스 타입 | Minor | **Patch** |

---

## 마이그레이션 가이드

### 기존 사용자 (v1.4.0)

1. 최신 버전으로 업데이트:
   ```bash
   cd /path/to/claude-code-usage-analytics
   git pull origin develop
   pipx uninstall claude-code-usage-analytics
   pipx install -e .
   ```

2. 변경사항 확인:
   ```bash
   ccu
   # [w] 키를 눌러 weekly 모드 진입
   # Usage Limits에서 Opus 권장 바가 독립적으로 표시되는지 확인
   ```

3. 추가 설정 불필요 - 자동으로 올바른 리셋 시각 사용

---

## 알려진 이슈

없음

---

## Breaking Changes

없음 - 하위 호환성 유지

---

## 다음 버전 계획

- [ ] Monthly/Yearly 뷰에 limits 표시 추가 (선택적)
- [ ] 권장 사용률 커스터마이징 옵션
- [ ] 사용량 추세 분석 기능

---

## 성능 및 최적화

- 계산 오버헤드: 무시할 수 있는 수준 (단일 datetime 계산 추가)
- 메모리 사용량: 변화 없음
- 렌더링 성능: 영향 없음

---

## 관련 문서

- [Version 1.4.0](./1.4.0.md) - Opus 독립 리셋 시각 처리 (usage 모드)
- [Version 1.3.9](./1.3.9.md) - 색상 모드 수정 및 버전 관리 개선
- [CLAUDE.md](../../CLAUDE.md) - 프로젝트 개발 가이드
- [README.md](../../README.md) - 사용자 문서

---

**Contributors:**
- wangtae
- Claude (Co-Authored-By: Claude <noreply@anthropic.com>)

**관련 이슈:**
- 없음 (v1.4.0 완성을 위한 패치)

**릴리스 노트:**
- v1.4.1은 v1.4.0의 누락된 부분을 수정한 패치 릴리스입니다.
- weekly 모드를 자주 사용하는 사용자는 업데이트를 권장합니다.
